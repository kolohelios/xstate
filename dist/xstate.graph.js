!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.XStateGraph={})}(this,function(t){"use strict";var e,n,r=function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function i(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&(n[r[i]]=t[r[i]])}return n}function o(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function s(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t}!function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication"}(e||(e={})),function(t){t.Parent="#_parent",t.Internal="#_internal"}(n||(n={}));var u=".",c={};function h(t){return"string"!=typeof t&&("value"in t&&"tree"in t&&"history"in t)}function f(t){return Object.keys(t)}function d(t,e,n){void 0===n&&(n=u);var r=y(t,n),i=y(e,n);return"string"==typeof i?"string"==typeof r&&i===r:"string"==typeof r?r in i:f(r).every(function(t){return t in i&&d(r[t],i[t])})}function l(t){try{return"string"==typeof t||"number"==typeof t?""+t:t.type}catch(t){throw new Error("Events must be strings or objects with a string event.type property.")}}function p(t){try{return"string"==typeof t||"number"==typeof t?""+t:"function"==typeof t?t.name:t.type}catch(t){throw new Error("Actions must be strings or objects with a string action.type property.")}}function v(t,e){try{return Array.isArray(t)?t:t.toString().split(e)}catch(e){throw new Error("'"+t+"' is not a valid state path.")}}function y(t,e){return h(t)?t.value:Array.isArray(t)?g(t):"string"==typeof t||h(t)?g(v(t,e)):t}function g(t){if(1===t.length)return t[0];for(var e={},n=e,r=0;r<t.length-1;r++)r===t.length-2?n[t[r]]=t[r+1]:(n[t[r]]={},n=n[t[r]]);return e}function m(t,e){var n={};return f(t).forEach(function(r,i){n[r]=e(t[r],r,t,i)}),n}function S(t,e,n){var r={};return f(t).forEach(function(i){var o=t[i];n(o)&&(r[i]=e(o,i,t))}),r}var w=function(t){return function(e){var n,r,i=e;try{for(var a=o(t),s=a.next();!s.done;s=a.next()){i=i[s.value]}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}};var x=function(t){return t?"string"==typeof t?[[t]]:b(f(t).map(function(e){var n=t[e];return"string"==typeof n||Object.keys(n).length?x(t[e]).map(function(t){return[e].concat(t)}):[[e]]})):[[]]};function b(t){var e;return(e=[]).concat.apply(e,s(t))}function E(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function N(t,e,n){return"function"==typeof t?t(e,n):f(t).reduce(function(r,i){var o=t[i];return r[i]="function"==typeof o?o(e,n):o,r},{})}var O=function(){function t(t){this.actions=[],this.activities=c,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this.event=t.event,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||c,this.meta=t.meta||{},this.events=t.events||[],Object.defineProperty(this,"tree",{value:t.tree,enumerable:!1})}return t.from=function(n,r){return n instanceof t?n.context!==r?new t({value:n.value,context:r,event:n.event,historyValue:n.historyValue,history:n.history,actions:[],activities:n.activities,meta:{},events:[],tree:n.tree}):n:new t({value:n,context:r,event:{type:e.Init},historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[]})},t.create=function(e){return new t(e)},t.inert=function(n,r){if(n instanceof t){if(!n.actions.length)return n;var i={type:e.Init};return new t({value:n.value,context:r,event:i,historyValue:n.historyValue,history:n.history,activities:n.activities,tree:n.tree})}return t.from(n,r)},Object.defineProperty(t.prototype,"inert",{get:function(){return t.inert(this,this.context)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextEvents",{get:function(){return this.tree?this.tree.nextEvents:[]},enumerable:!0,configurable:!0}),t.prototype.toStrings=function(t,e){var n=this;if(void 0===t&&(t=this.value),void 0===e&&(e="."),"string"==typeof t)return[t];var r=f(t);return r.concat.apply(r,s(r.map(function(r){return n.toStrings(t[r]).map(function(t){return r+e+t})})))},t.prototype.matches=function(t){return d(t,this.value)},Object.defineProperty(t.prototype,"changed",{get:function(){if(this.history)return!!this.actions.length||typeof this.history.value!=typeof this.value||!function t(e,n){if(e===n)return!0;if("string"==typeof e||"string"==typeof n)return e===n;var r=f(e),i=f(n);return r.length===i.length&&r.every(function(r){return t(e[r],n[r])})}(this.value,this.history.value)},enumerable:!0,configurable:!0}),t}(),P=e.Start,j=e.Stop,V=e.Raise,k=e.Send,T=e.Cancel,A=e.NullEvent,_=e.Assign,L=(e.After,e.DoneState,e.Log),C=e.Init,I=e.Invoke,D=e.ErrorExecution,R={type:C};function z(t){return"string"==typeof t||"number"==typeof t?{type:t}:t}function M(t,e){if(e){var n=e[t];if(n)return n}}function J(t,e){var n;if("string"==typeof t||"number"==typeof t){var o=M(t,e);n="function"==typeof o?{type:t,exec:o}:o||{type:t,exec:void 0}}else if("function"==typeof t)n={type:t.name||t.toString(),exec:t};else{if("function"==typeof(o=M(t.type,e)))n=r({},t,{exec:o});else if(o){var a=t.type,s=i(t,["type"]);n=r({type:a},o,s)}else n=t}return Object.defineProperty(n,"toString",{value:function(){return n.type},enumerable:!1,configurable:!0}),n}function F(t){var e=J(t);return r({id:"string"==typeof t?t:e.id},e,{type:e.type})}function H(t){return{type:V,event:t}}function U(t){var n=F(t);return{type:e.Start,activity:n,exec:void 0}}function B(t,n){var r=n?"#"+n:"";return e.After+"("+t+")"+r}function Q(t,n){var r=e.DoneState+"."+t,i={type:r,data:n,toString:function(){return r}};return i}function X(t,n){var r=e.DoneInvoke+"."+t,i={type:r,data:n,toString:function(){return r}};return i}function G(t,n){return{src:n,type:e.ErrorExecution,data:t}}var q={resolved:!1},K=function(){function t(e,n,i){var o;void 0===i&&(i=q),this.stateNode=e,this.stateValue=n,this.nodes=n?"string"==typeof n?((o={})[n]=new t(e.getStateNode(n),void 0),o):m(n,function(n,r){return new t(e.getStateNode(r),n)}):{};var a=r({},q,i);this.isResolved=a.resolved}return Object.defineProperty(t.prototype,"done",{get:function(){var t=this;switch(this.stateNode.type){case"final":return!0;case"compound":return"final"===this.nodes[f(this.nodes)[0]].stateNode.type;case"parallel":return f(this.nodes).every(function(e){return t.nodes[e].done});default:return!1}},enumerable:!0,configurable:!0}),t.prototype.getDoneData=function(t,e){if(this.done&&"compound"===this.stateNode.type){var n=this.nodes[f(this.nodes)[0]];if(!n.stateNode.data)return;return N(n.stateNode.data,t,e)}},Object.defineProperty(t.prototype,"atomicNodes",{get:function(){var t=this;return"atomic"===this.stateNode.type||"final"===this.stateNode.type?[this.stateNode]:b(f(this.value).map(function(e){return t.value[e].atomicNodes}))},enumerable:!0,configurable:!0}),t.prototype.getDoneEvents=function(t){var e=this;if(!t||!t.size)return[];if(t.has(this.stateNode)&&"final"===this.stateNode.type)return[Q(this.stateNode.id,this.stateNode.data)];var n=b(f(this.nodes).map(function(n){return e.nodes[n].getDoneEvents(t)}));if("parallel"===this.stateNode.type){var r=f(this.nodes).every(function(t){return e.nodes[t].done});return n&&r?n.concat(Q(this.stateNode.id)):n}if(!this.done||!n.length)return n;var i=1===n.length?n[0].data:void 0;return n.concat(Q(this.stateNode.id,i))},Object.defineProperty(t.prototype,"resolved",{get:function(){return new t(this.stateNode,this.stateNode.resolve(this.value),{resolved:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paths",{get:function(){return x(this.value)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"absolute",{get:function(){var e=this,n=this.stateValue,r={},i=r;return this.stateNode.path.forEach(function(t,r){r===e.stateNode.path.length-1?i[t]=n:(i[t]={},i=i[t])}),new t(this.stateNode.machine,r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextEvents",{get:function(){var t=this,e=this.stateNode.ownEvents,n=b(f(this.nodes).map(function(e){return t.nodes[e].nextEvents}));return s(new Set(n.concat(e)))},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.stateNode,this.value)},t.prototype.combine=function(t){var e,n=this;if(t.stateNode!==this.stateNode)throw new Error("Cannot combine distinct trees");if("compound"===this.stateNode.type){var r=void 0;if(f(this.nodes).length&&f(t.nodes).length){var i=f(this.nodes)[0];return(e={})[i]=this.nodes[i].combine(t.nodes[i]),r=e,(o=this.clone()).nodes=r,o}return r=Object.assign({},this.nodes,t.nodes),(o=this.clone()).nodes=r,o}if("parallel"===this.stateNode.type){var o,a=new Set(s(f(this.nodes),f(t.nodes))),u={};return a.forEach(function(e){n.nodes[e]&&t.nodes[e]?u[e]=n.nodes[e].combine(t.nodes[e]):u[e]=n.nodes[e]||t.nodes[e]}),(o=this.clone()).nodes=u,o}return this},Object.defineProperty(t.prototype,"value",{get:function(){if("atomic"===this.stateNode.type||"final"===this.stateNode.type)return{};if("parallel"===this.stateNode.type)return m(this.nodes,function(t){return t.value});if("compound"===this.stateNode.type){if(0===f(this.nodes).length)return{};var t=this.nodes[f(this.nodes)[0]].stateNode;return"atomic"===t.type||"final"===t.type?t.key:m(this.nodes,function(t){return t.value})}return{}},enumerable:!0,configurable:!0}),t.prototype.matches=function(t){return d(t,this.value)},t.prototype.getEntryExitStates=function(t,e){var n=this;if(t.stateNode!==this.stateNode)throw new Error("Cannot compare distinct trees");switch(this.stateNode.type){case"compound":var r={exit:[],entry:[]},i=f(this.nodes)[0],o=f(t.nodes)[0];return i!==o?(r.exit=t.nodes[o].getExitStates(),r.entry=this.nodes[i].getEntryStates()):r=this.nodes[i].getEntryExitStates(t.nodes[o],e),e&&e.has(this.stateNode)&&(r.exit.push(this.stateNode),r.entry.unshift(this.stateNode)),r;case"parallel":var a=f(this.nodes).map(function(r){return n.nodes[r].getEntryExitStates(t.nodes[r],e)}),u={exit:[],entry:[]};return a.forEach(function(t){u.exit=s(u.exit,t.exit),u.entry=s(u.entry,t.entry)}),e&&e.has(this.stateNode)&&(u.exit.push(this.stateNode),u.entry.unshift(this.stateNode)),u;case"atomic":default:return e&&e.has(this.stateNode)?{exit:[this.stateNode],entry:[this.stateNode]}:{exit:[],entry:[]}}},t.prototype.getEntryStates=function(){var t=this;return this.nodes?[this.stateNode].concat(b(f(this.nodes).map(function(e){return t.nodes[e].getEntryStates()}))):[this.stateNode]},t.prototype.getExitStates=function(){var t=this;return this.nodes?b(f(this.nodes).map(function(e){return t.nodes[e].getExitStates()})).concat(this.stateNode):[this.stateNode]},t}(),W=".",Y="",Z={},$=function(t){return"#"===t[0]},tt=function(){return{guards:Z}},et=!0,nt=(function(){function t(e,n,i){void 0===n&&(n=tt());var o=this;this._config=e,this.options=n,this.context=i,this.__cache={events:void 0,relativeValue:new Map,initialState:void 0},this.idMap={},this.key=e.key||e.id||"(machine)",this.parent=e.parent,this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=e.delimiter||(this.parent?this.parent.delimiter:W),this.id=e.id||(this.machine?s([this.machine.key],this.path).join(this.delimiter):this.key),this.type=e.type||(e.parallel?"parallel":e.states&&f(e.states).length?"compound":e.history?"history":"atomic"),!et&&"parallel"in e&&console.warn('The "parallel" property is deprecated and will be removed in version 4.1. '+(e.parallel?"Replace with `type: 'parallel'`":"Use `type: '"+this.type+"'`")+" in the config for state node '"+this.id+"' instead."),this.initial=e.initial,this.order=e.order||-1,this.states=e.states?m(e.states,function(e,n,i,a){var s,u=new t(r({},e,{key:n,order:void 0===e.order?a:e.order,parent:o}));return Object.assign(o.idMap,r(((s={})[u.id]=u,s),u.idMap)),u}):Z,this.history=!0===e.history?"shallow":e.history||!1,this.transient=!(!e.on||!e.on[Y]),this.strict=!!e.strict,this.onEntry=E(e.onEntry).map(function(t){return J(t)}),this.onExit=E(e.onExit).map(function(t){return J(t)}),this.meta=e.meta,this.data="final"===this.type?e.data:void 0,this.invoke=E(e.invoke).map(function(e,n){var i,a;if(e instanceof t)return(o.parent||o).options.services=r(((i={})[e.id]=e,i),(o.parent||o).options.services),{type:I,src:e.id,id:e.id};if("string"!=typeof e.src){var s=o.id+":invocation["+n+"]";return o.machine.options.services=r(((a={})[s]=e.src,a),(o.parent||o).options.services),r({type:I,id:s},e,{src:s})}return r({},e,{type:I,id:e.id||e.src,src:e.src})}),this.activities=E(e.activities).concat(this.invoke).map(function(t){return o.resolveActivity(t)})}t.prototype.withConfig=function(e,n){void 0===n&&(n=this.context);var i=this.options,o=i.actions,a=i.activities,s=i.guards,u=i.services;return new t(this.definition,{actions:r({},o,e.actions),activities:r({},a,e.activities),guards:r({},s,e.guards),services:r({},u,e.services)},n)},t.prototype.withContext=function(e){return new t(this.definition,this.options,e)},Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,type:this.type,initial:this.initial,history:this.history,states:m(this.states,function(t){return t.definition}),on:this.on,onEntry:this.onEntry,onExit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.data}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){var t=this._config;t.parent;return i(t,["parent"])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"on",{get:function(){return this.formatTransitions()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){var t=this;return b(f(this.on).map(function(e){return t.on[e]}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){var t=this,e=this.config.after;if(!e)return[];if(Array.isArray(e))return e.map(function(e){return r({event:B(e.delay,t.id)},e,{actions:E(e.actions).map(function(t){return J(t)})})});var n=b(f(e).map(function(n){var i=e[n],o=+n,a=B(o,t.id);return"string"==typeof i?[{target:i,delay:o,event:a,actions:[]}]:E(i).map(function(t){return r({event:a,delay:o},t,{actions:E(t.actions).map(function(t){return J(t)})})})}));return n.sort(function(t,e){return t.delay-e.delay}),n},enumerable:!0,configurable:!0}),t.prototype.getStateNodes=function(t){var e,n=this;if(!t)return[];var r=t instanceof O?t.value:y(t,this.delimiter);if("string"==typeof r){var i=this.getStateNode(r).initial;return void 0!==i?this.getStateNodes(((e={})[r]=i,e)):[this.states[r]]}var o=f(r);return o.map(function(t){return n.getStateNode(t)}).concat(o.reduce(function(t,e){var i=n.getStateNode(e).getStateNodes(r[e]);return t.concat(i)},[]))},t.prototype.handles=function(t){var e=l(t);return-1!==this.events.indexOf(e)},t.prototype.transitionLeafNode=function(t,e,n,r){var i=this.getStateNode(t).next(e,n,r);if(!i.tree){var o=this.next(e,n,r),a=o.reentryStates,s=o.actions;return{tree:o.tree,source:e,reentryStates:a,actions:s}}return i},t.prototype.transitionCompoundNode=function(t,e,n,r){var i=f(t),o=this.getStateNode(i[0])._transition(t[i[0]],e,n,r);if(!o.tree){var a=this.next(e,n,r),s=a.reentryStates,u=a.actions;return{tree:a.tree,source:e,reentryStates:s,actions:u}}return o},t.prototype.transitionParallelNode=function(t,e,n,r){var i=this,o={};if(f(t).forEach(function(a){var s=t[a];if(s){var u=i.getStateNode(a)._transition(s,e,n,r);u.tree,o[a]=u}}),!f(o).some(function(t){return void 0!==o[t].tree})){var a=this.next(e,n,r),u=a.reentryStates,c=a.actions;return{tree:a.tree,source:e,reentryStates:u,actions:c}}var h=f(o).map(function(t){return o[t].tree}).filter(function(t){return void 0!==t}).reduce(function(t,e){return t.combine(e)});return 1!==h.paths.length||d(y(this.path,this.delimiter),h.value)?{tree:f(o).map(function(t){var n=o[t],r=w(i.path)(n.tree?n.tree.value:e.value||e.value)[t];return new K(i.getStateNode(t),r).absolute}).reduce(function(t,e){return t.combine(e)}),source:e,reentryStates:f(o).reduce(function(t,e){var n=o[e],r=n.tree,i=n.reentryStates;return r&&i?new Set(s(Array.from(t),Array.from(i))):t},new Set),actions:b(f(o).map(function(t){return o[t].actions}))}:{tree:h,source:e,reentryStates:f(o).map(function(t){return o[t].reentryStates}).reduce(function(t,e){return new Set(s(Array.from(t||[]),Array.from(e||[])))},new Set),actions:b(f(o).map(function(t){return o[t].actions}))}},t.prototype._transition=function(t,e,n,r){return"string"==typeof t?this.transitionLeafNode(t,e,n,r):1===f(t).length?this.transitionCompoundNode(t,e,n,r):this.transitionParallelNode(t,e,n,r)},t.prototype.next=function(t,e,n){var r,i,a=this,u=e.type,c=this.on[u],h=this.transient?[{type:A}]:[];if(!c||!c.length)return{tree:void 0,source:t,reentryStates:void 0,actions:h};var f,l=[];try{for(var p=o(c),v=p.next();!v.done;v=p.next()){var g=v.value,m=g,S=m.cond,x=m.in,N=n||Z,O=!x||("string"==typeof x&&$(x)?t.matches(y(this.getStateNodeById(x).path,this.delimiter)):d(y(x,this.delimiter),w(this.path.slice(0,-2))(t.value)));if((!S||this.evaluateGuard(S,N,e,t.value))&&O){l=E(g.target),h.push.apply(h,s(E(g.actions))),f=g;break}}}catch(t){r={error:t}}finally{try{v&&!v.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}if(f&&0===l.length)return{tree:t.value?this.machine.getStateTree(t.value):void 0,source:t,reentryStates:void 0,actions:h};if(!f&&0===l.length)return{tree:void 0,source:t,reentryStates:void 0,actions:h};var P=b(l.map(function(e){return a.getRelativeStateNodes(e,t.historyValue)})),j=!!f.internal?[]:b(P.map(function(t){return a.nodesFromChild(t)}));return{tree:P.map(function(t){return t.tree}).reduce(function(t,e){return t.combine(e)}),source:t,reentryStates:new Set(j),actions:h}},Object.defineProperty(t.prototype,"tree",{get:function(){var t=y(this.path,this.delimiter);return new K(this.machine,t)},enumerable:!0,configurable:!0}),t.prototype.nodesFromChild=function(t){if(t.escapes(this))return[];for(var e=[],n=t;n&&n!==this;)e.push(n),n=n.parent;return e.push(this),e},t.prototype.getStateTree=function(t){return new K(this,t)},t.prototype.escapes=function(t){if(this===t)return!1;for(var e=this.parent;e;){if(e===t)return!1;e=e.parent}return!0},t.prototype.evaluateGuard=function(t,e,n,r){var i,o=this.machine.options.guards;if("string"==typeof t){if(!o||!o[t])throw new Error("Condition '"+t+"' is not implemented on machine '"+this.machine.id+"'.");i=o[t]}else i=t;return i(e,n,r)},Object.defineProperty(t.prototype,"delays",{get:function(){var t=this;return Array.from(new Set(this.transitions.map(function(t){return t.delay}).filter(function(t){return void 0!==t}))).map(function(e){return{id:t.id,delay:e}})},enumerable:!0,configurable:!0}),t.prototype.getActions=function(t,n){var r=this,i=t.tree?t.tree.resolved.getEntryExitStates(this.getStateTree(n.value),t.reentryStates?t.reentryStates:void 0):{entry:[],exit:[]},o=t.tree?t.tree.getDoneEvents(new Set(i.entry)):[];t.source||(i.exit=[],i.entry.unshift(this));var a={entry:b(Array.from(new Set(i.entry)).map(function(t){return s(t.activities.map(function(t){return U(t)}),t.onEntry,t.delays.map(function(t){var e,n,r=t.delay,i=t.id;return e=B(r,i),{to:(n={delay:r})?n.to:void 0,type:k,event:"function"==typeof e?e:z(e),delay:n?n.delay:void 0,id:n&&void 0!==n.id?n.id:"function"==typeof e?e.name:l(e)}}))})).concat(o.map(H)),exit:b(Array.from(new Set(i.exit)).map(function(t){return s(t.onExit,t.activities.map(function(t){return function(t){var n=F(t);return{type:e.Stop,activity:n,exec:void 0}}(t)}),t.delays.map(function(t){var e,n=t.delay,r=t.id;return e=B(n,r),{type:T,sendId:e}}))}))};return a.exit.concat(t.actions).concat(a.entry).map(function(t){return r.resolveAction(t)})},t.prototype.resolveAction=function(t){return J(t,this.machine.options.actions)},t.prototype.resolveActivity=function(t){return F(t)},t.prototype.getActivities=function(t,e){if(!t)return Z;var n=r({},e);return t.exit.forEach(function(t){t.activities.forEach(function(t){n[t.type]=!1})}),t.entry.forEach(function(t){t.activities.forEach(function(t){n[t.type]=!0})}),n},t.prototype.transition=function(t,n,i){var o="string"==typeof t?this.resolve(g(this.getResolvedPath(t))):t instanceof O?t:this.resolve(t),a=i||(t instanceof O?t.context:this.machine.context),s=z(n),u=s.type;if(this.strict&&-1===this.events.indexOf(u)&&!function(t){return 0===t.indexOf(e.DoneState)||0===t.indexOf(e.DoneInvoke)||t===e.ErrorCommunication||t===e.ErrorCommunication}(u))throw new Error("Machine '"+this.id+"' does not accept event '"+u+"'");var c=O.from(o,a),h=this._transition(c.value,c,s,a),f=r({},h,{tree:h.tree?h.tree.resolved:void 0});return this.resolveTransition(f,c,s)},t.prototype.resolveTransition=function(n,i,o){var a,u=this,c=n.tree?n.tree.value:void 0,h=i.historyValue?i.historyValue:n.source?this.machine.historyValue(i.value):void 0;if(!et&&n.tree)try{this.ensureValidPaths(n.tree.paths)}catch(t){throw new Error("Event '"+(o?o.type:"none")+"' leads to an invalid configuration: "+t.message)}var f=this.getActions(n,i),d=n.tree?n.tree.getEntryExitStates(this.getStateTree(i.value)):{entry:[],exit:[]},l=n.tree?this.getActivities({entry:new Set(d.entry),exit:new Set(d.exit)},i.activities):{},p=f.filter(function(t){return t.type===V||t.type===A}),v=f.filter(function(t){return t.type!==V&&t.type!==A&&t.type!==_}),y=f.filter(function(t){return t.type===_}),g=t.updateContext(i.context,o,y),m=v.map(function(t){var n=J(t);return n.type===k?function(t,e,n){var i="function"==typeof t.event?z(t.event(e,n)):z(t.event),o="function"==typeof t.delay?t.delay(e,n):t.delay;return r({},t,{event:i,delay:o})}(n,g,o||{type:e.Init}):J(n,u.options.actions)}),S=c?this.getStateNodes(c):[];S.some(function(t){return t.transient})&&p.push({type:A});var w=s([this],S).reduce(function(t,e){return void 0!==e.meta&&(t[e.id]=e.meta),t},{}),x=c?new O({value:c,context:g,event:o||R,historyValue:h?t.updateHistoryValue(h,c):void 0,history:n.source?i:void 0,actions:m,activities:l,meta:w,events:p,tree:n.tree}):void 0;if(!x)return new O({value:i.value,context:g,event:o,historyValue:i.historyValue,history:i,actions:[],activities:i.activities,meta:i.meta,events:[],tree:i.tree});x.history&&delete x.history.history;for(var b=x.history,E=x;p.length;){var N=E.actions,P=p.shift();(a=(E=this.transition(E,P.type===A?Y:P.event,E.context)).actions).unshift.apply(a,s(N))}return E.historyValue=x.historyValue,E.history=b,E},t.updateContext=function(t,n,r){return t?r.reduce(function(t,r){var i=r.assignment,o={};return"function"==typeof i?o=i(t,n||{type:e.Init}):f(i).forEach(function(e){var r=i[e];o[e]="function"==typeof r?r(t,n):r}),Object.assign({},t,o)},t):t},t.prototype.ensureValidPaths=function(t){var e,n,r=this,i=new Map,a=b(t.map(function(t){return r.getRelativeStateNodes(t)}));try{t:for(var s=o(a),u=s.next();!u.done;u=s.next())for(var c=u.value,h=c;h.parent;){if(i.has(h.parent)){if("parallel"===h.parent.type)continue t;throw new Error("State node '"+c.id+"' shares parent '"+h.parent.id+"' with state node '"+i.get(h.parent).map(function(t){return t.id})+"'")}i.get(h.parent)?i.get(h.parent).push(c):i.set(h.parent,[c]),h=h.parent}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}},t.prototype.getStateNode=function(t){if($(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '"+t+"' from '"+this.id+"'; no child states exist.");var e=this.states[t];if(!e)throw new Error("Child state '"+t+"' does not exist on '"+this.id+"'");return e},t.prototype.getStateNodeById=function(t){var e=$(t)?t.slice("#".length):t;if(e===this.id)return this;var n=this.machine.idMap[e];if(!n)throw new Error("Substate '#"+e+"' does not exist on '"+this.id+"'");return n},t.prototype.getStateNodeByPath=function(t){for(var e=v(t,this.delimiter).slice(),n=this;e.length;){var r=e.shift();n=n.getStateNode(r)}return n},t.prototype.resolve=function(t){var e,n=this;if(!t)return this.initialStateValue||Z;switch(this.type){case"parallel":return m(this.initialStateValue,function(e,r){return e?n.getStateNode(r).resolve(t[r]||e):Z});case"compound":if("string"==typeof t){var r=this.getStateNode(t);return"parallel"===r.type||"compound"===r.type?((e={})[t]=r.initialStateValue,e):t}return f(t).length?m(t,function(t,e){return t?n.getStateNode(e).resolve(t):Z}):this.initialStateValue||{};default:return t||Z}},Object.defineProperty(t.prototype,"resolvedStateValue",{get:function(){var t,e,n=this.key;if("parallel"===this.type)return(t={})[n]=S(this.states,function(t){return t.resolvedStateValue[t.key]},function(t){return!("history"===t.type)}),t;if(void 0===this.initial)return n;if(!this.states[this.initial])throw new Error("Initial state '"+this.initial+"' not found on '"+n+"'");return(e={})[n]=this.states[this.initial].resolvedStateValue,e},enumerable:!0,configurable:!0}),t.prototype.getResolvedPath=function(t){if($(t)){var e=this.machine.idMap[t.slice("#".length)];if(!e)throw new Error("Unable to find state node '"+t+"'");return e.path}return v(t,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){if(this.__cache.initialState)return this.__cache.initialState;var t="parallel"===this.type?S(this.states,function(t){return t.initialStateValue||Z},function(t){return!("history"===t.type)}):"string"==typeof this.resolvedStateValue?void 0:this.resolvedStateValue[this.key];return this.__cache.initialState=t,this.__cache.initialState},enumerable:!0,configurable:!0}),t.prototype.getInitialState=function(e,n){void 0===n&&(n=this.machine.context);var r={},i=[];this.getStateNodes(e).forEach(function(t){t.onEntry&&i.push.apply(i,s(t.onEntry)),t.activities&&t.activities.forEach(function(t){r[l(t)]=!0,i.push(U(t))})});var o=i.filter(function(t){return"object"==typeof t&&t.type===_}),a=t.updateContext(n,void 0,o);return new O({value:e,context:a,event:R,activities:r})},Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '"+this.id+"'.");var n=this.getInitialState(t);return this.resolveTransition({tree:this.getStateTree(t),source:void 0,reentryStates:new Set(this.getStateNodes(t)),actions:[]},n,{type:e.Init})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var t;if("history"===this.type){var e=this.config;t=e.target&&"string"==typeof e.target&&$(e.target)?g(this.machine.getStateNodeById(e.target).path.slice(this.path.length-1)):e.target}return t},enumerable:!0,configurable:!0}),t.prototype.getStates=function(t){var e=this;if("string"==typeof t)return[this.states[t]];var n=[];return f(t).forEach(function(r){n.push.apply(n,s(e.states[r].getStates(t[r])))}),n},t.prototype.getRelativeStateNodes=function(t,e,n){if(void 0===n&&(n=!0),"string"==typeof t&&$(t)){var r=this.getStateNodeById(t);return n?"history"===r.type?r.resolveHistory(e):r.initialStateNodes:[r]}var i=v(t,this.delimiter),o=(this.parent||this).getFromRelativePath(i,e);return n?b(o.map(function(t){return t.initialStateNodes})):o},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var t=this;return"atomic"===this.type||"final"===this.type?[this]:"compound"!==this.type||this.initial?b(x(this.initialStateValue).map(function(e){return t.getFromRelativePath(e)})):(et||console.warn("Compound state node '"+this.id+"' has no initial state."),[this])},enumerable:!0,configurable:!0}),t.prototype.getFromRelativePath=function(t,e){if(!t.length)return[this];var n=a(t),r=n[0],i=n.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '"+r+"' from node with no states");var o=this.getStateNode(r);if("history"===o.type)return o.resolveHistory(e);if(!this.states[r])throw new Error("Child state '"+r+"' does not exist on '"+this.id+"'");return this.states[r].getFromRelativePath(i,e)},t.updateHistoryStates=function(e,n){return m(e.states,function(e,r){if(e){var i=("string"==typeof n?void 0:n[r])||(e?e.current:void 0);if(i)return{current:i,states:t.updateHistoryStates(e,i)}}})},t.updateHistoryValue=function(e,n){return{current:n,states:t.updateHistoryStates(e,n)}},t.prototype.historyValue=function(t){if(f(this.states).length)return{current:t||this.initialStateValue,states:S(this.states,function(e,n){if(!t)return e.historyValue();var r="string"==typeof t?void 0:t[n];return e.historyValue(r||e.initialStateValue)},function(t){return!t.history})}},t.prototype.resolveHistory=function(t){var e=this;if("history"!==this.type)return[this];var n=this.parent;if(!t)return this.target?b(x(this.target).map(function(t){return n.getFromRelativePath(t)})):n.initialStateNodes;var r,i,a=(r=n.path,i="states",function(t){var e,n,a=t;try{for(var s=o(r),u=s.next();!u.done;u=s.next()){var c=u.value;a=a[i][c]}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return a})(t).current;return"string"==typeof a?[n.getStateNode(a)]:b(x(a).map(function(t){return"deep"===e.history?n.getFromRelativePath(t):[n.states[t[0]]]}))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var t=this,e=b(f(this.states).map(function(e){return t.states[e].stateIds}));return[this.id].concat(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){if(this.__cache.events)return this.__cache.events;var t=this.states,e=new Set(this.ownEvents);return t&&f(t).forEach(function(n){var r,i,a=t[n];if(a.states)try{for(var s=o(a.events),u=s.next();!u.done;u=s.next()){var c=u.value;e.add(""+c)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}),this.__cache.events=Array.from(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var t=this,e=new Set(f(this.on).filter(function(e){return t.on[e].some(function(t){return!(!t.target&&!t.actions.length&&t.internal)})}));return Array.from(e)},enumerable:!0,configurable:!0}),t.prototype.formatTransition=function(e,n,i){var o=this,a=!!n&&n.internal;if(void 0===e||""===e)return r({},n,{actions:n?E(n.actions).map(function(t){return J(t)}):[],target:void 0,internal:!n||(void 0===n.internal||n.internal),event:i});var s=E(e).map(function(e){if(e instanceof t)return"#"+e.id;var n="string"==typeof e&&e[0]===o.delimiter;return a=a||n,n&&!o.parent?e.slice(1):n?o.key+e:""+e});return r({},n,{actions:n?E(n.actions).map(function(t){return J(t)}):[],target:s,internal:a,event:i})},t.prototype.formatTransitions=function(){var e,n=this,i=this.config.on||Z,o=this.config.onDone?((e={})[""+Q(this.id)]=this.config.onDone,e):void 0,a=this.invoke.reduce(function(t,e){return e.onDone&&(t[X(e.id)]=e.onDone),e.onError&&(t[D]=e.onError),t},{}),s=this.after,u=m(r({},i,o,a),function(e,r){return void 0===e?[{target:void 0,event:r,actions:[],internal:!0}]:Array.isArray(e)?e.map(function(t){return n.formatTransition(t.target,t,r)}):"string"==typeof e||e instanceof t?[n.formatTransition([e],void 0,r)]:(et||f(e).forEach(function(t){if(-1===["target","actions","internal","in","cond","event"].indexOf(t))throw new Error("State object mapping of transitions is deprecated. Check the config for event '"+r+"' on state '"+n.id+"'.")}),[n.formatTransition(e.target,e,r)])});return s.forEach(function(t){u[t.event]=u[t.event]||[],u[t.event].push(t)}),u}}(),function(){function t(e,i){void 0===i&&(i=t.defaultOptions);var o=this;this.machine=e,this.eventQueue=[],this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.children=new Map,this.forwardTo=new Set,this.init=this.start,this.send=function(t){var e=z(t),n=o.nextState(e);return o.update(n,t),o.forward(e),n},this.sender=function(t){return function(){return this.send(t)}.bind(o)},this.sendTo=function(t,e){var r=e===n.Parent,i=r?o.parent:o.children.get(e);if(i)setTimeout(function(){i.send(t)});else{if(!r)throw new Error("Unable to send event to child '"+e+"' from service '"+o.id+"'.");console.warn("Service '"+o.id+"' has no parent: unable to send event "+t.type)}};var a=r({},t.defaultOptions,i),s=a.clock,u=a.logger,c=a.parent,h=a.id,f=void 0!==h?h:e.id;Object.assign(this,{clock:s,logger:u,parent:c,id:f}),this.options=a}return Object.defineProperty(t.prototype,"initialState",{get:function(){return this.machine.initialState},enumerable:!0,configurable:!0}),t.prototype.execute=function(t){var e=this;t.actions.forEach(function(n){e.exec(n,t.context,t.event)})},t.prototype.update=function(t,e){var n=this;if(this.state=t,this.options.execute&&this.execute(this.state),this.devTools&&this.devTools.send(e,t),t.event&&this.eventListeners.forEach(function(e){return e(t.event)}),this.listeners.forEach(function(e){return e(t,t.event)}),this.contextListeners.forEach(function(t){return t(n.state.context,n.state.history?n.state.history.context:void 0)}),this.state.tree&&this.state.tree.done){var r=this.state.tree.getDoneData(this.state.context,z(e));this.doneListeners.forEach(function(t){return t(X(n.id,r))}),this.stop()}this.flushEventQueue()},t.prototype.onTransition=function(t){return this.listeners.add(t),this},t.prototype.onEvent=function(t){return this.eventListeners.add(t),this},t.prototype.onSend=function(t){return this.sendListeners.add(t),this},t.prototype.onChange=function(t){return this.contextListeners.add(t),this},t.prototype.onStop=function(t){return this.stopListeners.add(t),this},t.prototype.onDone=function(t){return this.doneListeners.add(t),this},t.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},t.prototype.start=function(t){return void 0===t&&(t=this.machine.initialState),this.initialized=!0,this.options.devTools&&this.attachDev(),this.update(t,{type:C}),this},t.prototype.stop=function(){var t=this;return this.listeners.forEach(function(e){return t.listeners.delete(e)}),this.stopListeners.forEach(function(e){e(),t.stopListeners.delete(e)}),this.contextListeners.forEach(function(e){return t.contextListeners.delete(e)}),this.doneListeners.forEach(function(e){return t.doneListeners.delete(e)}),this.children.forEach(function(t){"function"==typeof t.stop&&t.stop()}),this.initialized=!1,this},t.prototype.nextState=function(t){var e=z(t);if(!this.initialized)throw new Error('Unable to send event "'+e.type+'" to an uninitialized service (ID: '+this.machine.id+"). Make sure .start() is called for this service.\nEvent: "+JSON.stringify(t));if(e.type===D&&-1===this.state.nextEvents.indexOf(D))throw e.data;return this.machine.transition(this.state,e,this.state.context)},t.prototype.forward=function(t){var e=this;this.forwardTo.forEach(function(n){var r=e.children.get(n);if(!r)throw new Error("Unable to forward event '"+t+"' from interpreter '"+e.id+"' to nonexistant child '"+n+"'.");r.send(t)})},t.prototype.defer=function(t){var e=this;return this.clock.setTimeout(function(){t.to?e.sendTo(t.event,t.to):e.send(t.event)},t.delay||0)},t.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},t.prototype.exec=function(t,n,r){if(t.exec)return t.exec(n,r,{action:t});switch(t.type){case k:var i=t;if(i.delay)return void(this.delayedEventsMap[i.id]=this.defer(i));i.to?this.sendTo(i.event,i.to):this.eventQueue.push(i.event);break;case T:this.cancel(t.sendId);break;case P:var o=t.activity;if(o.type===e.Invoke){var a=this.machine.options.services?this.machine.options.services[o.src]:void 0,s=o.id,u=o.data,c=!!o.forward;if(!a)return void console.warn("No service found for invocation '"+o.src+"' in machine '"+this.machine.id+"'.");var h="function"==typeof a?a(n,r):a;h instanceof Promise?this.spawnPromise(s,h):"function"==typeof h?this.spawnCallback(s,h):"string"!=typeof h&&this.spawn(u?h.withContext(N(u,n,r)):h,{id:s,autoForward:c})}else{var f=this.machine.options&&this.machine.options.activities?this.machine.options.activities[o.type]:void 0;if(!f)return void console.warn("No implementation found for activity '"+o.type+"'");var d=f(n,o);this.spawnEffect(o.id,d)}break;case j:this.stopChild(t.activity.id);break;case L:var l=t.expr?t.expr(n,r):void 0;t.label?this.logger(t.label,l):this.logger(l);break;default:console.warn("No implementation found for action type '"+t.type+"'")}},t.prototype.stopChild=function(t){var e=this.children.get(t);e&&"function"==typeof e.stop&&(e.stop(),this.children.delete(t),this.forwardTo.delete(t))},t.prototype.spawn=function(e,n){var r=this;void 0===n&&(n={});var i=new t(e,{parent:this,id:n.id||e.id,devTools:!1});return i.onDone(function(t){r.send(t)}).start(),this.children.set(i.id,i),n.autoForward&&this.forwardTo.add(i.id),i},t.prototype.spawnPromise=function(t,e){var n=this,r=!1;e.then(function(e){r||n.send(X(t,e))}).catch(function(e){n.send(G(e,t))}),this.children.set(t,{send:function(){},stop:function(){r=!0}})},t.prototype.spawnCallback=function(t,e){var n,r=this,i=function(e){et||console.warn("Event '"+e.type+"' sent to callback service '"+t+"' but was not handled by a listener.")};try{(n=e(function(t){return r.send(t)},function(t){i=t}))instanceof Promise&&n.catch(function(e){return r.send(G(e,t))})}catch(e){this.send(G(e,t))}this.children.set(t,{send:i,stop:n})},t.prototype.spawnEffect=function(t,e){this.children.set(t,{send:function(){},stop:e})},t.prototype.flushEventQueue=function(){var t=this.eventQueue.shift();t&&this.send(t)},t.prototype.attachDev=function(){this.options.devTools&&"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&(this.devTools=window.__REDUX_DEVTOOLS_EXTENSION__.connect({name:this.id,features:{jump:!1,skip:!1}}),this.devTools.init(this.state))},t.defaultOptions=function(t){return{execute:!0,clock:{setTimeout:function(e,n){return t.setTimeout.call(null,e,n)},clearTimeout:function(e){return t.clearTimeout.call(null,e)}},logger:t.console.log.bind(console),devTools:!0}}("undefined"==typeof window?global:window),t.interpret=rt,t}());function rt(t,e){return new nt(t,e)}var it={};function ot(t,e){return b(t.definition.on[e].map(function(n){var r=n.target?[].concat(n.target):void 0;return r?r.map(function(r){try{var i=r?t.getRelativeStateNodes(r,void 0,!1)[0]:t;return{source:t,target:i,event:e,actions:n.actions?n.actions.map(p):[],cond:n.cond,transition:n}}catch(e){return void console.warn("Target '"+r+"' not found on '"+t.id+"'")}}).filter(function(t){return void 0!==t}):[{source:t,target:t,event:e,actions:n.actions?n.actions.map(p):[],cond:n.cond,transition:n}]}))}function at(t,e){var n={},r=t.events;return function i(a){var s,u,c=JSON.stringify(a);if(!n[c]){n[c]={};try{for(var h=o(r),f=h.next();!f.done;f=h.next()){var d=f.value,l=t.transition(a,d,e);n[c][d]={state:l.value},i(l.value)}}catch(t){s={error:t}}finally{try{f&&!f.done&&(u=h.return)&&u.call(h)}finally{if(s)throw s.error}}}}(t.initialState.value),n}function st(t){var e=a(t.split(" | "),2),n=e[0],r=e[1];return{value:JSON.parse(n),context:void 0===r?void 0:JSON.parse(r)}}function ut(t){var e=t.value,n=t.context;return void 0===n?JSON.stringify(e):JSON.stringify(e)+" | "+JSON.stringify(n)}function ct(t){return JSON.stringify(t)}function ht(t){return JSON.parse(t)}var ft=function(){function t(t,e){this.machine=t,this.options=r({events:{},stateSerializer:ut,eventSerializer:ct},e),this.mapping=dt(t,e)}return t.prototype.reaches=function(t,e){var n=this.machine.resolve(t),r=O.from(n,e);return!!this.mapping[this.options.stateSerializer(r)]},t}();function dt(t,e){var n=r({events:{},stateSerializer:ut,eventSerializer:ct},e),i=n.filter,a=n.stateSerializer,s=n.eventSerializer,u={};t.events.forEach(function(t){u[t]=[t]}),Object.assign(u,n.events);var c={};return function e(n){var r,h,f=n.nextEvents,d=a(n);if(!c[d]){c[d]={};var l=b(f.map(function(t){return u[t]||[]})).map(function(t){return z(t)});try{for(var p=o(l),v=p.next();!v.done;v=p.next()){var y=v.value,g=t.transition(n,y);i&&!i(g)||d===a(g)||(c[d][s(y)]=g,e(g))}}catch(t){r={error:t}}finally{try{v&&!v.done&&(h=p.return)&&h.call(p)}finally{if(r)throw r.error}}}}(t.initialState),c}function lt(t,e){var n;if(!t.states)return it;var r=at(t,e),i=((n={})[JSON.stringify(t.initialState.value)]=[],n),a=new Set;return function e(n){var u,c,h,d,l=JSON.stringify(n);a.add(l);var p=r[l];try{for(var v=o(f(p)),g=v.next();!g.done;g=v.next()){var m=g.value;if(b=p[m].state){var S=JSON.stringify(y(b,t.delimiter));(!i[S]||i[S].length>i[l].length+1)&&(i[S]=s(i[l]||[],[{state:{value:n,context:void 0},event:{type:m}}]))}}}catch(t){u={error:t}}finally{try{g&&!g.done&&(c=v.return)&&c.call(v)}finally{if(u)throw u.error}}try{for(var w=o(f(p)),x=w.next();!x.done;x=w.next()){var b;(b=p[x.value].state)&&(S=JSON.stringify(b),a.has(S)||e(b))}}catch(t){h={error:t}}finally{try{x&&!x.done&&(d=w.return)&&d.call(w)}finally{if(h)throw h.error}}return i}(t.initialState.value),i}function pt(t,e){if(!t.states)return it;var n=dt(t,e),r=new Set,i=[],a={};var u=ut(t.initialState);return f(n).forEach(function(t){!function t(e,u){var c,h;if(r.add(e),e===u)a[u]=a[u]||[],a[u].push(s(i));else try{for(var d=o(f(n[e])),l=d.next();!l.done;l=d.next()){var p=l.value,v=n[e][p];if(v){var y=ut(v);r.has(y)||(i.push({state:st(e),event:ht(p)}),t(y,u))}}}catch(t){c={error:t}}finally{try{l&&!l.done&&(h=d.return)&&h.call(d)}finally{if(c)throw c.error}}i.pop(),r.delete(e)}(u,t)}),a}t.getNodes=function t(e){var n=e.states;return f(n).reduce(function(e,r){var i=n[r],o=t(n[r]);return e.push.apply(e,s([i],o)),e},[])},t.getEventEdges=ot,t.getEdges=function t(e,n){var r=(n||{}).depth,i=void 0===r?null:r,o=[];return e.states&&null===i?f(e.states).forEach(function(n){o.push.apply(o,s(t(e.states[n])))}):i&&i>0&&f(e.states).forEach(function(n){o.push.apply(o,s(t(e.states[n],{depth:i-1})))}),f(e.on).forEach(function(t){o.push.apply(o,s(ot(e,t)))}),o},t.getAdjacencyMap=at,t.deserializeStateString=st,t.serializeState=ut,t.serializeEvent=ct,t.deserializeEventString=ht,t.ValueAdjacency=ft,t.getValueAdjacencyMap=dt,t.getShortestValuePaths=function(t,e){if(!t.states)return it;var n=dt(t,e),r={},i=new Set;return function t(e){var a,u,c,h,d=ut(e);i.add(d);var l=n[d];try{for(var p=o(f(l)),v=p.next();!v.done;v=p.next()){var y=v.value,g=l[y],m=g.value,S=g.context;if(m){var w=ut(P=O.from(m,S));(!r[w]||r[w].length>r[d].length+1)&&(r[w]=s(r[d]||[],[{state:{value:m,context:void 0},event:{type:y}}]))}}}catch(t){a={error:t}}finally{try{v&&!v.done&&(u=p.return)&&u.call(p)}finally{if(a)throw a.error}}try{for(var x=o(f(l)),b=x.next();!b.done;b=x.next()){var E=l[b.value],N=(m=E.value,E.context);if(m){var P=O.from(m,N);w=ut(O.from(m,N)),i.has(w)||t(P)}}}catch(t){c={error:t}}finally{try{b&&!b.done&&(h=x.return)&&h.call(x)}finally{if(c)throw c.error}}return r}(t.initialState),r},t.getShortestPaths=lt,t.getShortestPathsAsArray=function(t,e){var n=lt(t,e);return f(n).map(function(t){return{state:JSON.parse(t),path:n[t]}})},t.getSimplePaths=pt,t.getSimplePathsAsArray=function(t,e){var n=pt(t,e);return f(n).map(function(t){return{state:JSON.parse(t),paths:n[t]}})},Object.defineProperty(t,"__esModule",{value:!0})});
